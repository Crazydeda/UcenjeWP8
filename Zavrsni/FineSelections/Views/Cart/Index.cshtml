
@using FineSelections.Models
@model Dictionary<int,int>
@inject FineSelections.Data.AppDbContext Ctx
@{
    ViewData["Title"] = "Košarica";
    decimal total = 0;
}
<h1>Košarica</h1>
@if (!Model.Any())
{
    <p>Vaša košarica je prazna.</p>
}
else
{
    <table class="table">
        <thead><tr><th>Proizvod</th><th>Količina</th><th>Cijena</th><th>Ukupno</th><th></th></tr></thead>
        <tbody>
        @foreach (var kv in Model)
        {
            var p = await Ctx.Products.FindAsync(kv.Key);
            if (p is null) { continue; }
            var line = p.Cijena * kv.Value;
            total += line;
            <tr>
                <td>@p.Naziv</td>
                <td>@kv.Value</td>
                <td>@p.Cijena.ToString("C")</td>
                <td>@line.ToString("C")</td>
                <td>
                    <form asp-action="Remove" method="post">
                        <input type="hidden" name="id" value="@p.Id"/>
                        <button type="submit">Ukloni</button>
                    </form>
                </td>
            </tr>
        }
        </tbody>
    </table>
    <h3>Za platiti: @total.ToString("C")</h3>
    <form asp-action="Clear" method="post"><button class="btn danger">Isprazni košaricu</button></form>
}
